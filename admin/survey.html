<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard | PaddyID</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f6f7fb;
  margin: 0;
  padding: 30px;
}

h1 {
  margin-bottom: 8px;
}

.filter {
  margin: 20px 0;
}

select {
  padding: 8px 12px;
  font-size: 14px;
}

.cards {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 20px;
  margin-bottom: 30px;
}

.card {
  background: #fff;
  padding: 20px;
  border-radius: 14px;
  box-shadow: 0 4px 12px rgba(0,0,0,.08);
  text-align: center;
}

.card h2 {
  margin: 0;
  font-size: 32px;
  color: #ff5ca8;
}

.table-wrap {
  background: #fff;
  border-radius: 14px;
  padding: 20px;
  box-shadow: 0 4px 12px rgba(0,0,0,.08);
  overflow-x: auto;
}

table {
  width: 100%;
  border-collapse: collapse;
}

th, td {
  padding: 10px;
  border-bottom: 1px solid #eee;
  font-size: 14px;
}

th {
  background: #fafafa;
}

canvas {
  background: #fff;
  border-radius: 14px;
  padding: 20px;
  box-shadow: 0 4px 12px rgba(0,0,0,.08);
}
</style>
</head>

<body>

<h1>ðŸ“Š Dashboard Survey Customer</h1>
<p>Data realtime dari Google Sheet</p>

<div class="filter">
  Filter Bulan:
  <select id="monthFilter">
    <option value="all">Semua</option>
  </select>
</div>

<div class="cards">
  <div class="card">
    <p>Kepuasan Produk</p>
    <h2 id="avgProduk">-</h2>
  </div>
  <div class="card">
    <p>Layanan CS</p>
    <h2 id="avgCS">-</h2>
  </div>
  <div class="card">
    <p>Layanan WA</p>
    <h2 id="avgWA">-</h2>
  </div>
</div>

<canvas id="chart" height="120"></canvas>

<br>

<div class="table-wrap">
  <table id="dataTable">
    <thead>
      <tr>
        <th>Nama</th>
        <th>HP</th>
        <th>Alamat</th>
        <th>Produk</th>
        <th>CS</th>
        <th>WA</th>
        <th>Tanggal</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbykkMnmYEaD1-sVQWpMgBRyxapVrl88ykFwqw1N_xF8_iUmMJCiNtJj7TwbxbjZBaZ4XA/exec";

let rawData = [];
let chart;

fetch(API_URL)
  .then(res => res.json())
  .then(data => {
    rawData = data;
    initMonthFilter(data);
    render(data);
  });

function initMonthFilter(data){
  const months = [...new Set(data.map(d => d.Tanggal?.slice(0,7)))].filter(Boolean);
  const select = document.getElementById("monthFilter");

  months.forEach(m => {
    const opt = document.createElement("option");
    opt.value = m;
    opt.textContent = m;
    select.appendChild(opt);
  });

  select.onchange = () => {
    const val = select.value;
    const filtered = val === "all" ? rawData : rawData.filter(d => d.Tanggal.startsWith(val));
    render(filtered);
  };
}

function render(data){
  renderTable(data);
  renderStats(data);
  renderChart(data);
}

function renderTable(data){
  const tbody = document.querySelector("#dataTable tbody");
  tbody.innerHTML = "";
  data.forEach(d => {
    tbody.innerHTML += `
      <tr>
        <td>${d.nama}</td>
        <td>${d.hp}</td>
        <td>${d.alamat}</td>
        <td>${d.kepuasan_produk}</td>
        <td>${d.layanan_cs}</td>
        <td>${d.layanan_wa}</td>
        <td>${new Date(d.timestamp).toLocaleDateString()}</td>
      </tr>`;
  });
}

function avg(data, key){
  if(!data.length) return 0;
  return (data.reduce((a,b)=>a+Number(b[key]||0),0)/data.length).toFixed(1);
}

function renderStats(data){
  document.getElementById("avgProduk").textContent = avg(data,"kepuasan_produk");
  document.getElementById("avgCS").textContent = avg(data,"layanan_cs");
  document.getElementById("avgWA").textContent = avg(data,"layanan_wa");
}

function renderChart(data){
  const values = [
    avg(data,"kepuasan_produk"),
    avg(data,"layanan_cs"),
    avg(data,"layanan_wa")
  ];

  if(chart) chart.destroy();

  chart = new Chart(document.getElementById("chart"), {
    type: "bar",
    data: {
      labels: ["Produk","CS","WA"],
      datasets: [{
        data: values,
        backgroundColor: "#ff5ca8"
      }]
    },
    options: {
      scales: {
        y: { beginAtZero: true, max: 5 }
      }
    }
  });
}
</script>

</body>
</html>
